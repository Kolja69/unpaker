<Window x:Class="Unpaker.Desktop.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:fa="http://schemas.awesome.incremented/wpf/xaml/fontawesome.sharp"
        Title="Unpaker - Pak Archive Manager" 
        Height="700" Width="1200"
        WindowStartupLocation="CenterScreen"
        WindowStyle="None"
        AllowsTransparency="False"
        Icon="/Resources/icon.ico"
        Background="{StaticResource BackgroundDarkBrush}">
    
    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="32" 
                      ResizeBorderThickness="5"
                      GlassFrameThickness="0"
                      CornerRadius="0"/>
    </WindowChrome.WindowChrome>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Custom Title Bar -->
        <Grid Grid.Row="0" 
              Background="{StaticResource BackgroundDarkBrush}" 
              Height="32">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <!-- App Icon and Title -->
            <StackPanel Grid.Column="0" 
                        Orientation="Horizontal" 
                        Margin="8,0,0,0"
                        VerticalAlignment="Center">
                <Image Source="/Resources/icon.ico" 
                      Width="16" Height="16"
                      Margin="0,0,8,0"
                      VerticalAlignment="Center"/>
                <TextBlock x:Name="TitleText" 
                          Text="Unpaker by VPZ" 
                          FontSize="12" 
                          FontWeight="SemiBold"
                          Foreground="{StaticResource AccentBlueBrush}"
                          VerticalAlignment="Center"/>
            </StackPanel>
            
            <!-- Window Controls -->
            <StackPanel Grid.Column="2" 
                        Orientation="Horizontal"
                        WindowChrome.IsHitTestVisibleInChrome="True">
                <Button x:Name="AboutButton" 
                        Style="{StaticResource WindowControlButton}"
                        Click="AboutButton_Click"
                        ToolTip="About">
                    <fa:IconImage Icon="CircleInfo" Width="12" Height="12" Foreground="{StaticResource ForegroundBrush}"/>
                </Button>
                <Button x:Name="MinimizeButton" 
                        Content="&#xE921;" 
                        Style="{StaticResource WindowControlButton}"
                        Click="MinimizeButton_Click"/>
                <Button x:Name="MaximizeButton" 
                        Content="&#xE922;" 
                        Style="{StaticResource WindowControlButton}"
                        Click="MaximizeButton_Click"/>
                <Button x:Name="CloseButton" 
                        Content="&#xE8BB;" 
                        Style="{StaticResource CloseButton}"
                        Click="CloseButton_Click"/>
            </StackPanel>
        </Grid>

        <!-- Toolbar -->
        <Border Grid.Row="1" 
                Background="{StaticResource BackgroundMediumBrush}" 
                BorderBrush="{StaticResource BorderBrush}" 
                BorderThickness="0,0,0,1"
                Padding="8,6">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <!-- File Group -->
                    <Button Click="NewPak_Click"
                           Height="34"
                           Margin="0,0,4,0">
                        <StackPanel Orientation="Horizontal" Margin="12,0">
                            <fa:IconImage Icon="File" Width="14" Height="14" Foreground="{StaticResource ForegroundBrush}"/>
                            <TextBlock Text="New" Margin="6,0,0,0" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    <Button Click="OpenPak_Click"
                           Height="34"
                           Margin="0,0,12,0">
                        <StackPanel Orientation="Horizontal" Margin="12,0">
                            <fa:IconImage Icon="FolderOpen" Width="14" Height="14" Foreground="{StaticResource ForegroundBrush}"/>
                            <TextBlock Text="Open" Margin="6,0,0,0" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    
                    <!-- Edit Group -->
                    <Button Click="AddFiles_Click"
                           Height="34"
                           Margin="0,0,4,0"
                           x:Name="AddButton"
                           IsEnabled="False">
                        <StackPanel Orientation="Horizontal" Margin="12,0">
                            <fa:IconImage Icon="Plus" Width="14" Height="14" Foreground="{StaticResource ForegroundBrush}"/>
                            <TextBlock Text="Add" Margin="6,0,0,0" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    <Button Click="RemoveFiles_Click"
                           Height="34"
                           Margin="0,0,12,0"
                           x:Name="RemoveButton"
                           IsEnabled="False">
                        <StackPanel Orientation="Horizontal" Margin="12,0">
                            <fa:IconImage Icon="Trash" Width="14" Height="14" Foreground="{StaticResource ForegroundBrush}"/>
                            <TextBlock Text="Remove" Margin="6,0,0,0" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    
                    <!-- Extract Group -->
                    <Button Click="ExtractSelected_Click"
                           Height="34"
                           Margin="0,0,4,0"
                           x:Name="ExtractButton"
                           IsEnabled="False">
                        <StackPanel Orientation="Horizontal" Margin="12,0">
                            <fa:IconImage Icon="Download" Width="14" Height="14" Foreground="{StaticResource ForegroundBrush}"/>
                            <TextBlock Text="Extract" Margin="6,0,0,0" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    <Button Click="ExtractAll_Click"
                           Height="34"
                           x:Name="ExtractAllButton"
                           Margin="0,0,0,0"
                           IsEnabled="False">
                        <StackPanel Orientation="Horizontal" Margin="12,0">
                            <fa:IconImage Icon="FileZipper" Width="14" Height="14" Foreground="{StaticResource ForegroundBrush}"/>
                            <TextBlock Text="Extract All" Margin="6,0,0,0" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
                
                <!-- Reload, Save & Save As on right -->
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Style="{StaticResource ReloadButton}"
                           Click="ReloadPak_Click"
                           Height="34"
                           Margin="0,0,4,0"
                           x:Name="ReloadButton"
                           IsEnabled="False">
                        <StackPanel Orientation="Horizontal" Margin="12,0">
                            <fa:IconImage Icon="RotateRight" Width="14" Height="14" Foreground="Black"/>
                            <TextBlock Text="Reload" Margin="6,0,0,0" VerticalAlignment="Center" Foreground="Black"/>
                        </StackPanel>
                    </Button>
                    <Button Style="{StaticResource SaveButton}"
                           Click="SavePak_Click"
                           Height="34"
                           Margin="0,0,4,0"
                           x:Name="SaveButton"
                           IsEnabled="False">
                        <StackPanel Orientation="Horizontal" Margin="12,0">
                            <fa:IconImage Icon="FloppyDisk" Width="14" Height="14" Foreground="Black"/>
                            <TextBlock Text="Save" Margin="6,0,0,0" VerticalAlignment="Center" Foreground="Black"/>
                        </StackPanel>
                    </Button>
                    <Button Style="{StaticResource SaveButton}"
                           Click="SaveAsPak_Click"
                           Height="34"
                           x:Name="SaveAsButton"
                           IsEnabled="False">
                        <StackPanel Orientation="Horizontal" Margin="12,0">
                            <fa:IconImage Icon="FileExport" Width="14" Height="14" Foreground="Black"/>
                            <TextBlock Text="Save As" Margin="6,0,0,0" VerticalAlignment="Center" Foreground="Black"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content - Search and ListView -->
        <Grid Grid.Row="2" Margin="8">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Search Bar -->
            <Border Grid.Row="0" 
                    Background="{StaticResource BackgroundMediumBrush}"
                    BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="1"
                    Padding="8,4"
                    Margin="0,0,0,8">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <fa:IconImage Grid.Column="0" 
                              Icon="MagnifyingGlass" 
                              Width="14" Height="14"
                              Foreground="{StaticResource ForegroundDimBrush}"
                              Margin="0,0,8,0"
                              VerticalAlignment="Center"/>
                    
                    <TextBox Grid.Column="1" 
                            x:Name="SearchBox"
                            Style="{StaticResource SearchTextBox}"
                            TextChanged="SearchBox_TextChanged"
                            VerticalContentAlignment="Center"
                            Height="28"/>
                </Grid>
            </Border>

            <!-- ListView -->
            <ListView Grid.Row="1"
                     x:Name="FileListView"
                     SelectionMode="Extended"
                     SelectionChanged="FileListView_SelectionChanged"
                     MouseDoubleClick="FileListView_MouseDoubleClick"
                     GridViewColumnHeader.Click="GridViewColumnHeader_Click"
                     DisplayMemberPath="{x:Null}">
                <ListView.ContextMenu>
                    <ContextMenu>
                        <MenuItem Header="Extract" Click="ExtractSelected_Click" InputGestureText="Ctrl+E"/>
                        <MenuItem Header="Extract to..." Click="ExtractSelectedTo_Click"/>
                        <Separator Style="{StaticResource MenuSeparator}"/>
                        <MenuItem Header="Remove" Click="RemoveFiles_Click" InputGestureText="Del"/>
                    </ContextMenu>
                </ListView.ContextMenu>
                <ListView.View>
                    <GridView>
                        <GridViewColumn Header="File Path" Width="400" DisplayMemberBinding="{Binding FilePath}">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding FilePath}" 
                                              TextTrimming="CharacterEllipsis"
                                              ToolTip="{Binding FilePath}"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                        <GridViewColumn Header="Size" Width="100" DisplayMemberBinding="{Binding Size}">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Size}" 
                                              HorizontalAlignment="Right"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                        <GridViewColumn Header="Compressed" Width="100" DisplayMemberBinding="{Binding CompressedSize}">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding CompressedSize}" 
                                              HorizontalAlignment="Right"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                        <GridViewColumn Header="Uncompressed" Width="100" DisplayMemberBinding="{Binding UncompressedSize}">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding UncompressedSize}" 
                                              HorizontalAlignment="Right"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                        <GridViewColumn Header="Compression" Width="120" DisplayMemberBinding="{Binding Compression}">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Compression}"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                        <GridViewColumn Header="Offset" Width="120" DisplayMemberBinding="{Binding Offset}">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Offset}" 
                                              HorizontalAlignment="Right"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                    </GridView>
                </ListView.View>
            </ListView>
        </Grid>

        <!-- Progress Panel -->
        <Border Grid.Row="3" 
                Background="{StaticResource BackgroundMediumBrush}" 
                BorderBrush="{StaticResource BorderBrush}" 
                BorderThickness="0,1,0,0"
                Padding="12,8"
                x:Name="ProgressPanel"
                Visibility="Collapsed">
            <StackPanel>
                <TextBlock x:Name="ProgressText" 
                          Margin="0,0,0,4"/>
                <ProgressBar x:Name="ProgressBar" 
                            IsIndeterminate="True"
                            Height="8"/>
            </StackPanel>
        </Border>

        <!-- Status Bar -->
        <Border Grid.Row="4" 
                Background="{StaticResource BackgroundMediumBrush}" 
                BorderBrush="{StaticResource BorderBrush}" 
                BorderThickness="0,1,0,0"
                Padding="8,4">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <TextBlock Grid.Column="0"
                          x:Name="StatusText" 
                          Text="Ready" 
                          FontSize="11"
                          Foreground="{StaticResource ForegroundDimBrush}"
                          VerticalAlignment="Center"/>
                
                <Rectangle Grid.Column="1" 
                          Width="1" 
                          Fill="{StaticResource BorderBrush}" 
                          Margin="12,0"
                          x:Name="StatusSeparator"
                          Visibility="Collapsed"/>
                
                <TextBlock Grid.Column="2"
                          x:Name="PakInfoText" 
                          Text="" 
                          FontSize="11"
                          Foreground="{StaticResource ForegroundDimBrush}"
                          VerticalAlignment="Center"/>
            </Grid>
        </Border>
    </Grid>
</Window>
